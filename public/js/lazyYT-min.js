/*
* lazyYT (lazy load YouTube videos)
* v1.3.0 - 2016-03-06
* (CC) This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License.
* http://creativecommons.org/licenses/by-sa/4.0/
* Contributors: https://github.com/tylerpearson/lazyYT/graphs/contributors || https://github.com/daugilas/lazyYT/graphs/contributors
* 
* Usage: <div class="lazyYT" data-youtube-id="laknj093n" data-parameters="rel=0">loading...</div>
*/
(function(e){function a(u,l){var i=u.data("width"),s=u.data("height"),r=u.attr("title")||u.data("title"),g=u.data("display-title"),o=(u.data("ratio"))?u.data("ratio"):l.default_ratio,v=u.data("display-duration"),h=u.data("youtube-id"),q,j=[],t,m,p=u.text()?u.text():l.loading_text,k=["https://www.googleapis.com/youtube/v3/videos?id=",h,"&key=",l.yt_api_key,"&part=snippet"].join(""),n=u.data("parameters")||"";o=o.split(":");n+="&"+l.youtube_parameters;if(typeof g!="boolean"){g=l.display_title}if(typeof v!="boolean"){v=l.display_duration}if(typeof i==="number"&&typeof s==="number"){u.width(i);q=s+"px"}else{if(typeof i==="number"){u.width(i);q=(i*o[1]/o[0])+"px"}else{i=u.width();if(i==0){i=u.parent().width()}q=(o[1]/o[0]*100)+"%"}}j.push('<div class="ytp-thumbnail">');j.push('<button class="ytp-large-play-button ytp-button" tabindex="23" aria-live="assertive"');if(i<=320){j.push(' style="transform: scale(0.61);"')}else{if(i<=640){j.push(' style="transform: scale(0.85);"')}}if(g&&r){j.push(' aria-label="',r,'"')}j.push(">");j.push('<svg height="100%" version="1.1" viewBox="0 0 68 48" width="100%">');j.push('<path class="ytp-large-play-button-bg" d="m .66,37.62 c 0,0 .66,4.70 2.70,6.77 2.58,2.71 5.98,2.63 7.49,2.91 5.43,.52 23.10,.68 23.12,.68 .00,-1.3e-5 14.29,-0.02 23.81,-0.71 1.32,-0.15 4.22,-0.17 6.81,-2.89 2.03,-2.07 2.70,-6.77 2.70,-6.77 0,0 .67,-5.52 .67,-11.04 l 0,-5.17 c 0,-5.52 -0.67,-11.04 -0.67,-11.04 0,0 -0.66,-4.70 -2.70,-6.77 C 62.03,.86 59.13,.84 57.80,.69 48.28,0 34.00,0 34.00,0 33.97,0 19.69,0 10.18,.69 8.85,.84 5.95,.86 3.36,3.58 1.32,5.65 .66,10.35 .66,10.35 c 0,0 -0.55,4.50 -0.66,9.45 l 0,8.36 c .10,4.94 .66,9.45 .66,9.45 z" fill="#1f1f1e" fill-opacity="0.9"></path>');j.push('<path d="m 26.96,13.67 18.37,9.62 -18.37,9.55 -0.00,-19.17 z" fill="#fff"></path>');j.push('<path d="M 45.02,23.46 45.32,23.28 26.96,13.67 43.32,24.34 45.02,23.46 z" fill="#ccc"></path>');j.push("</svg>");j.push("</button>");j.push('<div class="ytp-spinner" data-layer="4">');j.push('<span class="ytp-spinner-svg">');j.push('<svg height="100%" version="1.1" viewBox="0 0 22 22" width="100%">');j.push('<svg x="7" y="1"><circle class="ytp-spinner-dot ytp-spinner-dot-0" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="11" y="3"><circle class="ytp-spinner-dot ytp-spinner-dot-1" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="13" y="7"><circle class="ytp-spinner-dot ytp-spinner-dot-2" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="11" y="11"><circle class="ytp-spinner-dot ytp-spinner-dot-3" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="7" y="13"><circle class="ytp-spinner-dot ytp-spinner-dot-4" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="3" y="11"><circle class="ytp-spinner-dot ytp-spinner-dot-5" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="1" y="7"><circle class="ytp-spinner-dot ytp-spinner-dot-6" cx="4" cy="4" r="2"></circle></svg>');j.push('<svg x="3" y="3"><circle class="ytp-spinner-dot ytp-spinner-dot-7" cx="4" cy="4" r="2"></circle></svg>');j.push("</svg>");j.push("</span>");j.push('<div class="ytp-spinner-message" style="display: none;">If playback doesn\'t begin shortly, try restarting your device.</div>');j.push("</div>");if(v){j.push('<span class="video-time" style="display:none;"></span>')}j.push("</div>");if(g){j.push('<div class="ytp-gradient-top"></div>');j.push('<div class="ytp-chrome-top">');j.push('<div class="ytp-title">');j.push('<div class="ytp-title-text">');j.push('<a id="lazyYT-title-',h,'" class="ytp-title-link" tabindex="13" target="_blank" data-sessionlink="feature=player-title" href="https://www.youtube.com/watch?v=',h,'">');j.push((r)?r:p);j.push("</a>");j.push("</div>");j.push("</div>");j.push("</div>")}u.css({"padding-bottom":q}).html(j.join(""));t=u.find(".ytp-thumbnail").on("click",function(w){w.preventDefault();if(!u.hasClass(l.video_loaded_class)){u.html('<iframe src="//www.youtube.com/embed/'+h+"?"+n+'&autoplay=1" frameborder="0" allowfullscreen></iframe>').addClass(l.video_loaded_class);if(typeof l.callback=="function"){l.callback.call(u)}}});d(h,i,t,k);if((!r&&g)||v){if(v){k+=",contentDetails"}e.getJSON(k,function(x){var w=x.items[0];u.find("#lazyYT-title-"+h).text(w.snippet.title);if(v){u.find(".video-time").text(b(w.contentDetails.duration,l)).show()}})}}function d(m,j,l,k){var h,i,g=new Image();if(j==0){j=l.width()}if(j>640){h="maxresdefault.jpg"}else{if(j>480){h="sddefault.jpg"}else{if(j>320){h="hqdefault.jpg"}else{if(j>120){h="mqdefault.jpg"}else{if(j==0){h="hqdefault.jpg"}else{h="default.jpg"}}}}}i=["https://img.youtube.com/vi/",m,"/",h].join("");g.onload=function(o){var n=c(o,"naturalWidth");if(n<j){e.getJSON(k,function(r){var q=r.items[0],p=q.snippet.thumbnails;if(j==0){j=l.width()}if(j>640&&typeof p.maxres=="object"){i=p.maxres.url}else{if(j>480&&typeof p.standard=="object"){i=p.standard.url}else{if(j>320&&typeof p.high=="object"){i=p.high.url}else{if(j>120&&typeof p.medium=="object"){i=p.medium.url}else{i=p["default"].url}}}}f(l,i)})}else{f(l,this.src)}};g.src=i}function f(h,g){h.css({"background-image":["url(",g,")"].join("")}).addClass("lazyYT-image-loaded")}function c(i,g){var h;if(typeof i.path=="object"){h=i.path[0]}else{if(typeof i.target=="object"){h=i.target}else{h=i.originalTarget}}return h.naturalWidth}function b(n,j){var g=[];var k=0;var l=n.match(/P(?:(\d*)Y)?(?:(\d*)M)?(?:(\d*)W)?(?:(\d*)D)?T(?:(\d*)H)?(?:(\d*)M)?(?:(\d*)S)?/i);var m=[{pos:1,multiplier:86400*365},{pos:2,multiplier:86400*30},{pos:3,multiplier:604800},{pos:4,multiplier:86400},{pos:5,multiplier:3600},{pos:6,multiplier:60},{pos:7,multiplier:1}];for(var h=0;h<m.length;h++){if(typeof l[m[h].pos]!="undefined"){k+=parseInt(l[m[h].pos])*m[h].multiplier}}if(k>3599){g.push(parseInt(k/3600));k%=3600}g.push(("0"+parseInt(k/60)).slice(-2));g.push(("0"+k%60).slice(-2));return g.join(":")}e.fn.lazyYT=function(h,g){var j={yt_api_key:h,youtube_parameters:"rel=0",loading_text:"Loading...",display_title:true,default_ratio:"16:9",display_duration:false,callback:null,video_loaded_class:"lazyYT-video-loaded",container_class:"lazyYT-container"};var i=e.extend(j,g);return this.each(function(){var k=e(this).addClass(i.container_class);a(k,i)})}}(jQuery));